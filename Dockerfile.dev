FROM norionomura/swiftlint:0.39.2 as builder

FROM swift:5.2.4-xenial-slim

COPY --from=builder /usr/bin/swiftlint /usr/bin/swiftlint
COPY --from=builder /usr/lib/libsourcekitdInProc.so /usr/lib/libsourcekitdInProc.so

RUN apt-get update && apt-get install -y openjdk-8-jre

COPY docs /docs
COPY target/universal/stage/ /workdir/
RUN chmod +x /workdir/bin/codacy-swiftlint
RUN adduser --uid 2004 -m docker
USER docker
WORKDIR /src
ENTRYPOINT ["/workdir/bin/codacy-swiftlint"]
